import{s as q,q as T,w as B,x as w,b as s,j as e,B as P,y as $,z as X,p as G,u as J,S as U,F as Y,k as _}from"./index-adccf17c.js";import{M as f,C as M,E as j}from"./ConfirmDelete-a7b5b5a7.js";import{u as ee}from"./index.esm-f0940a56.js";import{F as C,I as x}from"./FormRow-cfe24e74.js";import{F as ie}from"./Form-2653b5a8.js";import{F as ne}from"./FileInput-8669a2db.js";import{c as z,d as re,u as ae}from"./useCabins-3f94f354.js";import{F as te}from"./Filter-eeb78914.js";import{R as E}from"./Row-ec799910.js";import{S as se,T as D,M as v}from"./SortBy-858a954b.js";import{f as H}from"./helpers-28d71949.js";const ce=q.textarea`
  padding: 0.8rem 1.2rem;
  border: 1px solid var(--color-grey-300);
  border-radius: 5px;
  background-color: var(--color-grey-0);
  box-shadow: var(--shadow-sm);
  width: 100%;
  height: 8rem;
`;function O(){const c=T(),{mutate:i,isLoading:o}=B({mutationFn:z,onSuccess:()=>{w.success("New cabin successfully created"),c.invalidateQueries({queryKey:["cabins"]})},onError:n=>w.error(n.message)});return{isCreating:o,createCabin:i}}function oe(){const c=T(),{mutate:i,isLoading:o}=B({mutationFn:({newCabinData:n,id:d})=>z(n,d),onSuccess:()=>{w.success("Cabin successfully edited"),c.invalidateQueries({queryKey:["cabins"]})},onError:n=>w.error(n.message)});return{isEditing:o,editCabin:i}}function Q({cabinToEdit:c={},onCloseModal:i,type:o}){var L,k,A,I,N;const{isCreating:n,createCabin:d}=O(),{isEditing:p,editCabin:h}=oe(),t=n||p,{id:g,...y}=c,m=!!g,{register:l,handleSubmit:r,reset:u,watch:F,formState:S}=ee({defaultValues:m?y:{}}),{errors:a}=S,W=F("regularPrice");function K(b){const R=typeof b.image=="string"?b.image:b.image[0];m?h({newCabinData:{...b,image:R},id:g},{onSuccess:Z=>{u(),i==null||i()}}):d({...b,image:R},{onSuccess:Z=>{u(),i==null||i()}})}function V(b){console.log(b)}return s(ie,{onSubmit:r(K,V),type:o,children:[e(C,{label:"Cabin name",error:(L=a==null?void 0:a.name)==null?void 0:L.message,children:e(x,{type:"text",id:"name",disabled:t,...l("name",{required:"This field is required"})})}),e(C,{label:"Maximum capacity",error:(k=a==null?void 0:a.maxCapacity)==null?void 0:k.message,children:e(x,{type:"number",id:"maxCapacity",disabled:t,...l("maxCapacity",{required:"This field is required",min:{value:1,message:"Capacity should be at least 1"}})})}),e(C,{label:"Regular price",error:(A=a==null?void 0:a.regularPrice)==null?void 0:A.message,children:e(x,{type:"number",id:"regularPrice",disabled:t,...l("regularPrice",{required:"This field is required",min:{value:1,message:"Capacity should be at least 1"}})})}),e(C,{label:"Discount",error:(I=a==null?void 0:a.discount)==null?void 0:I.message,children:e(x,{type:"number",id:"discount",disabled:t,...l("discount",{required:"This field is required",validate:b=>b<=W||"Discount should be less than or equal to regular price"})})}),e(C,{label:"Description for website",error:(N=a==null?void 0:a.description)==null?void 0:N.message,children:e(ce,{type:"number",id:"description",defaultValue:"",disabled:t,...l("description",{required:"This field is required"})})}),e(C,{label:"Cabin photo",children:e(ne,{id:"image",accept:"image/*",...l("image",{required:m?!1:"This field is required"})})}),s(C,{children:[e(P,{variation:"secondary",type:"reset",onClick:()=>{i==null||i()},children:"Cancel"}),e(P,{disabled:t,children:m?"Edit cabin":"Create new cabin"})]})]})}function de(){return e("div",{children:s(f,{children:[e(f.Open,{opens:"cabin-form",children:e(P,{children:"Add Cabin"})}),e(f.Window,{name:"cabin-form",children:e(Q,{type:"modal"})})]})})}function le(){return s(E,{type:"horizontal",gap:"1rem",children:[e(te,{filterField:"discount",options:[{label:"All",value:"all"},{label:"Discount",value:"with-discount"},{label:"No discount",value:"no-discount"}]}),e(se,{options:[{label:"Name (A-Z)",value:"name-asc"},{label:"Name (Z-A)",value:"name-des"},{label:"Price (0-9)",value:"price-asc"},{label:"Price (9-0)",value:"price-des"},{label:"Capacity (0-9)",value:"capacity-asc"},{label:"Capacity (9-0)",value:"capacity-des"}]})]})}function ue(){const c=T(),{isLoading:i,mutate:o}=B({mutationFn:re,onSuccess:()=>{w.success("Cabin successfully deleted"),c.invalidateQueries({queryKey:["cabins"]})},onError:n=>w.error(n.message)});return{isDeleting:i,deleteCabin:o}}const me=q.img`
  display: block;
  width: 6.4rem;
  aspect-ratio: 3 / 2;
  object-fit: cover;
  object-position: center;
  transform: scale(1.5) translateX(-7px);
`,be=q.div`
  font-size: 1.6rem;
  font-weight: 600;
  color: var(--color-grey-600);
  font-family: "Sono";
`,pe=q.div`
  font-family: "Sono";
  font-weight: 600;
`,fe=q.div`
  font-family: "Sono";
  font-weight: 500;
  color: var(--color-green-700);
`;function he({cabin:c}){const{isDeleting:i,deleteCabin:o}=ue(),{isCreating:n,createCabin:d}=O(),{id:p,name:h,maxCapacity:t,regularPrice:g,discount:y,image:m,description:l}=c;function r(){d({name:`Copy of ${h}`,maxCapacity:t,regularPrice:g,discount:y,image:m,description:l})}return s(D.Row,{children:[e(me,{src:m}),e(be,{children:h}),s("div",{children:["Fits up to ",t," guests"]}),e(pe,{children:H(g)}),y?e(fe,{children:H(y)}):e("span",{children:"â€”"}),e("div",{children:e(f,{children:s(v.Menu,{children:[e(v.Toggle,{id:p}),s(v.List,{id:p,children:[e(v.Button,{icon:e($,{}),disabled:n,onClick:r,children:"Duplicate"}),e(f.Open,{opens:"edit",children:e(v.Button,{icon:e(X,{}),children:"Edit"})}),e(f.Open,{opens:"delete",children:e(v.Button,{icon:e(G,{}),children:"Delete"})})]}),e(f.Window,{name:"edit",children:e(Q,{cabinToEdit:c,type:"modal"})}),e(f.Window,{name:"delete",children:e(M,{resourceName:"cabins",disabled:i,onConfirm:()=>o(p)})})]})})})]})}function ge(){var l;const{isLoading:c,cabins:i}=ae(),[o]=J();if(c)return e(U,{});if(!i)return e(j,{resource:"cabins"});let n=i;const d=(l=o.get("sortBy"))==null?void 0:l.split("-"),p=(d==null?void 0:d[1])||null,h=(d==null?void 0:d[0])||null,t=o.get("discount");t&&t==="with-discount"&&(n=i==null?void 0:i.filter(r=>r.discount)),t&&t==="no-discount"&&(n=i==null?void 0:i.filter(r=>!r.discount));const g=(r,u)=>r.name.toLowerCase()<u.name.toLowerCase()?-1:r.name.toLowerCase()>u.name.toLowerCase()?1:0,y=(r,u)=>r.maxCapacity-u.maxCapacity,m=(r,u)=>r.regularPrice-u.regularPrice;if(p&&h&&n){const r={name:g,capacity:y,price:m};n=n.sort((u,F)=>{const S=r[h](u,F);return p==="asc"?S:-S})}return e(v,{children:s(D,{columns:"0.6fr 1.8fr 2.2fr 1fr 1fr 1fr",children:[s(D.Header,{children:[e("div",{}),e("div",{children:"Cabin"}),e("div",{children:"Capacity"}),e("div",{children:"Price"}),e("div",{children:"Discount"}),e("div",{})]}),n.length?e(D.Body,{data:n,render:r=>e(he,{cabin:r},r.id)}):e(j,{resource:"Cabins"})]})})}function Te(){return s(Y,{children:[s(E,{type:"horizontal",children:[e(_,{as:"h1",children:"All cabins"}),e(le,{})]}),s(E,{children:[e(ge,{}),e(de,{})]})]})}export{Te as default};
